# 角色场景管理系统实现方案

## 📋 **系统概述**

实现真实游戏流程的角色管理系统：
1. **场景分离**：友方角色和敌方角色独立场景文件
2. **个性化缩放**：每个角色独立的缩放配置
3. **真实流程**：Main初始化 → GameParty管理 → Level生成角色

---

## 🗂️ **文件夹结构规划**

```
Scenes/
├── Characters/
│   ├── Party/           # 友方角色场景
│   │   ├── JueYuan.tscn     # 觉远 (3倍缩放)
│   │   ├── LiuSheng.tscn    # 柳生 (2倍缩放)
│   │   └── Lancelot.tscn    # 兰斯洛特 (2倍缩放)
│   └── Enemies/         # 敌方角色场景
│       ├── Bandit_101.tscn  # 山贼头目
│       ├── Wolf_102.tscn    # 野狼
│       └── Skeleton_103.tscn # 骷髅战士
└── player.tscn         # 原始模板场景
```

---

## ⚙️ **系统配置**

### 全局设置
- **全局缩放**: 1.0倍（默认）
- **个性化缩放**: 通过CharacterScaleConfig节点配置

### 角色缩放配置
| 角色名称 | 缩放倍数 | 配置方式 |
|---------|---------|---------|
| 觉远 | 3.0倍 | CharacterScaleConfig节点 |
| 柳生 | 2.0倍 | CharacterScaleConfig节点 |
| 兰斯洛特 | 2.0倍 | CharacterScaleConfig节点 |
| 山贼头目 | 1.0倍 | 使用全局设置 |
| 野狼 | 1.0倍 | 使用全局设置 |
| 骷髅战士 | 1.0倍 | 使用全局设置 |

---

## 🔄 **游戏流程设计**

### 1. Main场景初始化 (Main.gd)
```gdscript
func _ready():
    # 初始化GameParty，添加队伍成员
    _initialize_party_members()
    
func _initialize_party_members():
    GameParty.add_member("1")  # 觉远
    GameParty.add_member("2")  # 柳生  
    GameParty.add_member("3")  # 兰斯洛特
```

### 2. GameParty管理角色
- **角色数据**: 从DataManager.csv加载
- **队伍管理**: GameParty.gd管理队伍成员列表
- **场景映射**: 角色ID → 对应的tscn文件路径

### 3. Level场景生成角色
- **读取队伍**: 从GameParty获取成员列表
- **实例化场景**: 根据角色ID加载对应的tscn文件
- **应用配置**: 自动识别CharacterScaleConfig并应用

---

## 🎯 **实现步骤**

### Step 1: 创建文件夹结构
```bash
mkdir -p Scenes/Characters/Party
mkdir -p Scenes/Characters/Enemies
```

### Step 2: 创建友方角色场景
1. **复制player.tscn** → JueYuan.tscn, LiuSheng.tscn, Lancelot.tscn
2. **添加CharacterScaleConfig节点**到每个场景
3. **配置个性化缩放参数**

### Step 3: 创建敌方角色场景  
1. **复制player.tscn** → Bandit_101.tscn, Wolf_102.tscn, Skeleton_103.tscn
2. **保持默认设置**（使用全局1.0倍缩放）

### Step 4: 更新游戏设置
1. **修改GameSettings**: 将全局缩放改为1.0倍
2. **验证CharacterScaleConfig**: 确保个性化配置正常工作

### Step 5: 实现GameParty初始化
1. **修改Main.gd**: 添加队伍初始化逻辑
2. **更新GameParty.gd**: 确保角色加入逻辑正确

### Step 6: 更新角色生成逻辑
1. **修改BattleCharacterManager**: 支持从GameParty读取并加载对应场景
2. **创建场景映射表**: 角色ID → tscn文件路径的映射

---

## 📁 **场景映射配置**

### 友方角色映射
```gdscript
const PARTY_SCENE_MAP = {
    "1": "res://Scenes/Characters/Party/JueYuan.tscn",
    "2": "res://Scenes/Characters/Party/LiuSheng.tscn", 
    "3": "res://Scenes/Characters/Party/Lancelot.tscn"
}
```

### 敌方角色映射
```gdscript
const ENEMY_SCENE_MAP = {
    "101": "res://Scenes/Characters/Enemies/Bandit_101.tscn",
    "102": "res://Scenes/Characters/Enemies/Wolf_102.tscn",
    "103": "res://Scenes/Characters/Enemies/Skeleton_103.tscn"
}
```

---

## ✅ **验证清单**

### 功能验证
- [ ] 文件夹结构创建完成
- [ ] 友方角色场景创建并配置缩放
- [ ] 敌方角色场景创建完成
- [ ] 全局缩放设置为1.0倍
- [ ] Main场景初始化GameParty
- [ ] Level场景从GameParty读取角色
- [ ] 角色缩放效果正确显示

### 缩放效果验证
- [ ] 觉远显示为3倍大小
- [ ] 柳生显示为2倍大小  
- [ ] 兰斯洛特显示为2倍大小
- [ ] 敌方角色显示为1倍大小（默认）

---

## 🎮 **系统优势**

### 1. **模块化设计**
- 每个角色独立场景文件
- 便于单独调试和修改
- 支持角色特殊配置

### 2. **真实游戏流程**
- 符合实际游戏开发模式
- GameParty统一管理队伍
- 支持动态添加/移除角色

### 3. **可扩展性**
- 新增角色只需创建新场景
- 配置系统支持个性化设置
- 便于后续功能扩展

### 4. **维护性**
- 清晰的文件组织结构
- 统一的配置管理方式
- 完整的文档说明

---

## 🔧 **技术细节**

### CharacterScaleConfig配置
```gdscript
# 觉远配置
scale_factor = 3.0
auto_apply_on_ready = true
override_global_scale = true

# 柳生/兰斯洛特配置  
scale_factor = 2.0
auto_apply_on_ready = true
override_global_scale = true
```

### BattleCharacterManager更新
- 支持场景路径映射
- 自动检测CharacterScaleConfig
- 优先使用个性化配置

这套系统将为你的游戏提供完整、可扩展的角色管理解决方案！ 
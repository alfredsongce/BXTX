# 2Dä¾§è§†è§’æ¸¸æˆå¤šå±‚èƒŒæ™¯ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†å¦‚ä½•åœ¨Godotä¸­ä¸º2Dä¾§è§†è§’æˆ˜æ–—æ¸¸æˆæ„å»ºå¤šå±‚èƒŒæ™¯ç³»ç»Ÿï¼Œå®ç°ç±»ä¼¼ã€Šæ‹³çš‡97ã€‹ç­‰ç»å…¸æ ¼æ–—æ¸¸æˆçš„è§†è§‰å±‚æ¬¡æ•ˆæœã€‚

### 1.1 è®¾è®¡ç›®æ ‡
- åˆ›å»ºå…·æœ‰æ·±åº¦æ„Ÿçš„å¤šå±‚èƒŒæ™¯
- å®ç°è§†å·®æ»šåŠ¨æ•ˆæœå¢å¼ºæ²‰æµ¸æ„Ÿ
- æ”¯æŒè¿œæ™¯ã€ä¸­æ™¯ã€è¿‘æ™¯çš„åˆ†å±‚æ¸²æŸ“
- ä¿æŒè‰¯å¥½çš„æ€§èƒ½è¡¨ç°
- æ˜“äºå…³å¡è®¾è®¡å’Œç»´æŠ¤

### 1.2 è§†è§‰å±‚æ¬¡æ¦‚å¿µ
```
å‰æ™¯å±‚ (è¿‘æ™¯)     Z-index: 100+     [é®æŒ¡è§’è‰²çš„è£…é¥°ç‰©]
â”œâ”€â”€ æ‚¬æŒ‚ç‰©å“å±‚       Z-index: 120       (ç¯ç¬¼ã€æ——å¸œç­‰)
â”œâ”€â”€ å‰æ™¯è£…é¥°å±‚       Z-index: 110       (å‰æ™¯æŸ±å­ã€æ æ†ç­‰)
â””â”€â”€ è§’è‰²é®æŒ¡å±‚       Z-index: 100       (ä¼šé®æŒ¡è§’è‰²çš„å…ƒç´ )

è§’è‰²æˆ˜æ–—å±‚ (æ ¸å¿ƒå±‚)  Z-index: 0~50     [ä¸»è¦æ¸¸æˆåŒºåŸŸ]
â”œâ”€â”€ è§’è‰²å±‚           Z-index: 10        (ç©å®¶ã€æ•Œäººã€ç‰¹æ•ˆ)
â”œâ”€â”€ éšœç¢ç‰©å±‚         Z-index: 5         (å½“å‰Obstacleå±‚)
â””â”€â”€ åœ°é¢åŸºç¡€å±‚       Z-index: 0         (åœ°æ¿ã€åŸºç¡€åœ°å½¢)

èƒŒæ™¯å±‚ (è¿œæ™¯)       Z-index: -100~-1   [èƒŒæ™¯è£…é¥°]
â”œâ”€â”€ ä¸­æ™¯è£…é¥°å±‚       Z-index: -10       (å»ºç­‘ç‰©ã€æ ‘æœ¨ç­‰)
â”œâ”€â”€ è¿œæ™¯å»ºç­‘å±‚       Z-index: -50       (è¿œå¤„å»ºç­‘ã€å±±è„‰)
â””â”€â”€ å¤©ç©ºå±‚           Z-index: -100      (å¤©ç©ºã€äº‘æœµã€è¿œå±±)
```

## 2. èŠ‚ç‚¹ç»“æ„è®¾è®¡

### 2.1 æ¨èçš„åœºæ™¯æ ‘ç»“æ„

#### BattleScene (ä¸»æˆ˜æ–—åœºæ™¯)
```
BattleScene (Node2D)
â”œâ”€â”€ BattleSystems (Node2D)                     # æˆ˜æ–—ç³»ç»Ÿå±‚
â”‚   â”œâ”€â”€ BattleManager
â”‚   â”œâ”€â”€ SkillSelectionCoordinator  
â”‚   â”œâ”€â”€ MovementCoordinator
â”‚   â””â”€â”€ ... (å…¶ä»–æˆ˜æ–—ç³»ç»Ÿ)
â”‚
â””â”€â”€ DynamicsLevel (Node2D)                     # åŠ¨æ€å…³å¡æŒ‚è½½ç‚¹
    â””â”€â”€ [å½“å‰å…³å¡åœºæ™¯ä¼šæŒ‚è½½åˆ°è¿™é‡Œ]
```

#### âœ… å…³å¡åœºæ™¯ç»“æ„ (LEVEL_1_åºå¹•.tscn) - **å·²å®Œæˆå®ç°**
```
LevelRoot (Node2D)                             âœ… å·²å®ç°
â”œâ”€â”€ BackgroundLayers (CanvasLayer) [layer = -1] âœ… å·²å®ç°
â”‚   â”œâ”€â”€ ParallaxBackground                      âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ SkyLayer (ParallaxLayer)           âœ… å·²å®ç° [motion_scale: (0.1, 0.1)]
â”‚   â”‚   â”‚   â””â”€â”€ SkySprites (Node2D)            âœ… å·²å®ç°
â”‚   â”‚   â”‚       â”œâ”€â”€ Sky (Sprite2D)             ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚   â”‚       â”œâ”€â”€ Clouds (Sprite2D)          ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚   â”‚       â””â”€â”€ FarMountains (Sprite2D)    ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ DistantLayer (ParallaxLayer)       âœ… å·²å®ç° [motion_scale: (0.3, 0.3)]
â”‚   â”‚   â”‚   â””â”€â”€ DistantSprites (Node2D)        âœ… å·²å®ç°
â”‚   â”‚   â”‚       â”œâ”€â”€ Mountains (Sprite2D)       ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚   â”‚       â”œâ”€â”€ DistantBuildings (Sprite2D) ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚   â”‚       â””â”€â”€ BackgroundTrees (Sprite2D) ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ MidgroundLayer (ParallaxLayer)     âœ… å·²å®ç° [motion_scale: (0.6, 0.6)]
â”‚   â”‚       â””â”€â”€ MidgroundSprites (Node2D)      âœ… å·²å®ç°
â”‚   â”‚           â”œâ”€â”€ Buildings (Sprite2D)       ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚           â”œâ”€â”€ LargeTrees (Sprite2D)      ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚   â”‚           â””â”€â”€ BackgroundProps (Sprite2D) ğŸ”„ å¾…æ·»åŠ è´´å›¾
â”‚
â”œâ”€â”€ GameplayLayers (Node2D)                    âœ… å·²å®ç°
â”‚   â”œâ”€â”€ GroundLayer (Node2D) [z_index = 0]     âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ FloorTiles (Node2D)                âœ… å·²å®ç°
â”‚   â”‚   â””â”€â”€ GroundDecoration (Node2D)          âœ… å·²å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ ObstacleLayer (Node2D) [z_index = 5]   âœ… å·²å®ç°
â”‚   â”‚   â””â”€â”€ Obstacles (Node2D)                 âœ… å·²å®ç°
â”‚   â”‚       â”œâ”€â”€ PlatformObstacle               âœ… å·²å®ç° (2ä¸ª)
â”‚   â”‚       â”œâ”€â”€ RockObstacle                   âœ… å·²å®ç° (5ä¸ª)
â”‚   â”‚       â”œâ”€â”€ WallObstacle                   âœ… å·²å®ç° (1ä¸ª)
â”‚   â”‚       â””â”€â”€ WaterObstacle                  âœ… å·²å®ç° (1ä¸ª)
â”‚   â”‚
â”‚   â”œâ”€â”€ CharacterSpawns (Node2D) [z_index = 10] âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ PlayerSpawns (Node2D)              âœ… å·²å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerSpawn1 (Marker2D)       âœ… å·²å®ç° (è§‰è¿œç”Ÿæˆç‚¹)
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerSpawn2 (Marker2D)       âœ… å·²å®ç° (æŸ³ç”Ÿç”Ÿæˆç‚¹)
â”‚   â”‚   â”‚   â””â”€â”€ PlayerSpawn3 (Marker2D)       âœ… å·²å®ç° (å…°æ–¯æ´›ç‰¹ç”Ÿæˆç‚¹)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ EnemySpawns (Node2D)               âœ… å·²å®ç°
â”‚   â”‚       â”œâ”€â”€ EnemySpawn1 (Marker2D)        âœ… å·²å®ç° (å±±è´¼å¤´ç›®ç”Ÿæˆç‚¹)
â”‚   â”‚       â”œâ”€â”€ EnemySpawn2 (Marker2D)        âœ… å·²å®ç° (é‡ç‹¼ç”Ÿæˆç‚¹)
â”‚   â”‚       â””â”€â”€ EnemySpawn3 (Marker2D)        âœ… å·²å®ç° (éª·é«…æˆ˜å£«ç”Ÿæˆç‚¹)
â”‚   â”‚
â”‚   â””â”€â”€ InteractiveProps (Node2D) [z_index = 15] âœ… å·²å®ç°
â”‚       â”œâ”€â”€ Breakables (Node2D)                âœ… å·²å®ç°
â”‚       â””â”€â”€ Collectibles (Node2D)              âœ… å·²å®ç°
â”‚
â”œâ”€â”€ ForegroundLayers (CanvasLayer) [é»˜è®¤z_index] âœ… å·²å®ç°
â”‚   â”œâ”€â”€ NearForeground (Node2D) [z_index = 100]  âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ ForegroundPillars (Node2D)          âœ… å·²å®ç°
â”‚   â”‚   â””â”€â”€ ForegroundRocks (Node2D)            âœ… å·²å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ HangingObjects (Node2D) [z_index = 110]  âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ Lanterns (Node2D)                   âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ Banners (Node2D)                    âœ… å·²å®ç°
â”‚   â”‚   â””â”€â”€ Chains (Node2D)                     âœ… å·²å®ç°
â”‚   â”‚
â”‚   â””â”€â”€ CoverLayer (Node2D) [z_index = 120]      âœ… å·²å®ç°
â”‚       â”œâ”€â”€ Fog (Node2D)                        âœ… å·²å®ç°
â”‚       â”œâ”€â”€ RainDrops (Node2D)                  âœ… å·²å®ç°
â”‚       â””â”€â”€ LightEffects (Node2D)               âœ… å·²å®ç°
â”‚
â””â”€â”€ Config (Node)                               âœ… å·²å®ç°
    â”œâ”€â”€ LevelConfiguration (Node)               âœ… å·²å®ç° (åŒ…å«æ•Œäººé…ç½®)
    â”œâ”€â”€ SpawnSettings (Node)                    âœ… å·²å®ç°
    â”œâ”€â”€ EnvironmentSettings (Node)              âœ… å·²å®ç°
    â”œâ”€â”€ GameplaySettings (Node)                 âœ… å·²å®ç°
    â””â”€â”€ SpawnPointManager (Node)                âœ… å·²å®ç°
```

### 2.2 å®ç°çŠ¶æ€æ€»ç»“

#### âœ… **å·²å®Œæˆéƒ¨åˆ†**ï¼š
1. **å®Œæ•´çš„èŠ‚ç‚¹ç»“æ„**ï¼š100%æŒ‰ç…§è®¾è®¡æ–‡æ¡£å®ç°
2. **è§†å·®æ»šåŠ¨å±‚æ¬¡**ï¼š3å±‚ParallaxLayeré…ç½®æ­£ç¡®
3. **Z-indexå±‚æ¬¡**ï¼šæ‰€æœ‰å±‚çº§çš„Z-indexè®¾ç½®æ­£ç¡®
4. **CanvasLayeråˆ†å±‚**ï¼šèƒŒæ™¯(-1)ã€å‰æ™¯(é»˜è®¤)åˆ†å±‚
5. **éšœç¢ç‰©ç³»ç»Ÿ**ï¼šå¤šç§ç±»å‹éšœç¢ç‰©å·²é…ç½®
6. **ç”Ÿæˆç‚¹ç³»ç»Ÿ**ï¼šç©å®¶å’Œæ•Œäººç”Ÿæˆç‚¹å®Œæ•´é…ç½®
7. **å…³å¡é…ç½®ç³»ç»Ÿ**ï¼šå®Œæ•´çš„é…ç½®èŠ‚ç‚¹ç»“æ„

#### ğŸ”„ **å¾…å®Œå–„éƒ¨åˆ†**ï¼š
1. **èƒŒæ™¯è´´å›¾èµ„æº**ï¼šéœ€è¦æ·»åŠ å®é™…çš„Sprite2Dè´´å›¾
2. **å‰æ™¯è£…é¥°ç‰©**ï¼šéœ€è¦æ·»åŠ å…·ä½“çš„è£…é¥°ç‰©ä»¶
3. **åœ°é¢è´´å›¾**ï¼šFloorTileséœ€è¦åœ°é¢çº¹ç†
4. **è§†è§‰æ•ˆæœ**ï¼šæ‚¬æŒ‚ç‰©åŠ¨ç”»ã€å…‰æ•ˆç­‰

### 2.3 èŠ‚ç‚¹è¯´æ˜

#### BattleScene å±‚çº§
- **BattleSystems**: åŒ…å«æ‰€æœ‰æˆ˜æ–—ç³»ç»Ÿç»„ä»¶ï¼ˆç®¡ç†å™¨ã€åè°ƒå™¨ç­‰ï¼‰
- **DynamicsLevel**: åŠ¨æ€å…³å¡æŒ‚è½½ç‚¹ï¼Œå…³å¡åœºæ™¯å°†å®ä¾‹åŒ–åˆ°æ­¤å¤„

#### å…³å¡åœºæ™¯å±‚çº§
- **BackgroundLayers (CanvasLayer)**: ç¡®ä¿æ‰€æœ‰èƒŒæ™¯å…ƒç´ éƒ½åœ¨æ¸¸æˆå±‚ä¹‹åæ¸²æŸ“
  - **layer**: -1 âœ… å·²æ­£ç¡®è®¾ç½®
  - **åŒ…å«**: æ‰€æœ‰è¿œæ™¯å’ŒèƒŒæ™¯è£…é¥°

- **GameplayLayers (Node2D)**: ä¸»è¦æ¸¸æˆé€»è¾‘åŒºåŸŸ
  - **z_index**: 0 (é»˜è®¤) âœ… å·²æ­£ç¡®è®¾ç½®
  - **åŒ…å«**: åœ°é¢ã€éšœç¢ç‰©ã€è§’è‰²ç”Ÿæˆç‚¹ç­‰å½±å“æ¸¸æˆç©æ³•çš„å…ƒç´ 

- **ForegroundLayers (CanvasLayer)**: å‰æ™¯è£…é¥°ï¼Œéƒ¨åˆ†ä¼šé®æŒ¡è§’è‰²
  - **z_index**: é»˜è®¤(0) âœ… å·²æ­£ç¡®è®¾ç½®
  - **åŒ…å«**: æ‰€æœ‰å‰æ™¯è£…é¥°å…ƒç´ 

- **Config (Node)**: å…³å¡é…ç½®èŠ‚ç‚¹ âœ… å·²å®ç°
  - **ä½œç”¨**: å­˜å‚¨è§’è‰²é…ç½®ã€å…³å¡å‚æ•°ç­‰æ•°æ®
  - **è„šæœ¬**: å¤šä¸ªé…ç½®ç»„ä»¶å®Œæ•´å®ç°

## 3. è§†å·®æ»šåŠ¨é…ç½®

### 3.1 ParallaxLayer è¿åŠ¨å€æ•° - âœ… **å·²å®ç°**

```gdscript
# è§†å·®è¿åŠ¨å€æ•°é…ç½®ï¼ˆå·²åœ¨LEVEL_1_åºå¹•.tscnä¸­æ­£ç¡®é…ç½®ï¼‰
# motion_scaleå€¼è¶Šå°ï¼Œç§»åŠ¨è¶Šæ…¢ï¼Œçœ‹èµ·æ¥è¶Šè¿œ

SkyLayer.motion_scale = Vector2(0.1, 0.1)        âœ… å·²é…ç½® (å¤©ç©ºå‡ ä¹ä¸åŠ¨)
DistantLayer.motion_scale = Vector2(0.3, 0.3)    âœ… å·²é…ç½® (è¿œæ™¯ç¼“æ…¢ç§»åŠ¨)
MidgroundLayer.motion_scale = Vector2(0.6, 0.6)  âœ… å·²é…ç½® (ä¸­æ™¯ä¸­ç­‰é€Ÿåº¦)
# æ¸¸æˆå±‚ = Vector2(1.0, 1.0) (é»˜è®¤ï¼Œæ— éœ€è®¾ç½®)
```

**ğŸ“ æ³¨æ„**ï¼šå½“å‰Yè½´motion_scaleä¸ä¸º0ï¼Œå¦‚æœéœ€è¦çº¯æ°´å¹³è§†å·®æ•ˆæœï¼Œå¯ä»¥å°†Yå€¼æ”¹ä¸º0ã€‚

### 3.2 ParallaxBackground è®¾ç½®

```gdscript
# åœ¨BattleSceneçš„_ready()å‡½æ•°ä¸­è®¾ç½®
func setup_parallax():
    var parallax_bg = $BackgroundLayers/ParallaxBackground
    
    # è®¾ç½®è§†å·®èƒŒæ™¯çš„æ»šåŠ¨é™åˆ¶
    parallax_bg.scroll_limit_begin = Vector2(-1000, -500)
    parallax_bg.scroll_limit_end = Vector2(1000, 500)
    
    # æ ¹æ®ç›¸æœºä½ç½®æ›´æ–°è§†å·®èƒŒæ™¯
    parallax_bg.scroll_offset = camera.global_position
```

## 4. å…·ä½“å®ç°æ­¥éª¤

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç»“æ„æ­å»º - âœ… **å·²å®Œæˆ**

åŸºç¡€ç»“æ„å·²åœ¨LEVEL_1_åºå¹•.tscnä¸­å®Œå…¨å®ç°ï¼š
- âœ… CanvasLayerèŠ‚ç‚¹åˆ›å»ºå®Œæˆ
- âœ… ParallaxBackgroundè®¾ç½®å®Œæˆ  
- âœ… ç°æœ‰Obstacleå±‚é‡ç»„å®Œæˆ
- âœ… Z-indexå±‚æ¬¡è®¾ç½®æ­£ç¡®

### 4.2 ç¬¬äºŒé˜¶æ®µï¼šèƒŒæ™¯å±‚å®ç° - âœ… **å®Œæˆï¼Œç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­é…ç½®è´´å›¾**

1. **å¤©ç©ºå±‚ (SkyLayer)** - âœ… ç»“æ„å®Œæˆ
   ```gdscript
   # ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­ä¸ºSprite2DèŠ‚ç‚¹è®¾ç½®texture
   SkySprites/
   â”œâ”€â”€ Sky (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   â”œâ”€â”€ Clouds (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§  
   â””â”€â”€ FarMountains (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   ```

2. **è¿œæ™¯å±‚ (DistantLayer)** - âœ… ç»“æ„å®Œæˆ
   ```gdscript
   # ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­ä¸ºSprite2DèŠ‚ç‚¹è®¾ç½®texture
   DistantSprites/
   â”œâ”€â”€ Mountains (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   â”œâ”€â”€ DistantBuildings (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   â””â”€â”€ BackgroundTrees (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   ```

3. **ä¸­æ™¯å±‚ (MidgroundLayer)** - âœ… ç»“æ„å®Œæˆ
   ```gdscript
   # ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­ä¸ºSprite2DèŠ‚ç‚¹è®¾ç½®texture
   MidgroundSprites/
   â”œâ”€â”€ Buildings (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   â”œâ”€â”€ LargeTrees (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   â””â”€â”€ BackgroundProps (Sprite2D) - åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®textureå±æ€§
   ```

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼šå‰æ™¯å±‚å®ç° - âœ… **ç»“æ„å®Œæˆï¼Œå¾…æ·»åŠ è£…é¥°ç‰©**

1. **æ‚¬æŒ‚ç‰©å±‚** - âœ… ç»“æ„å®Œæˆ
   ```gdscript
   # èŠ‚ç‚¹ç»“æ„å·²åˆ›å»ºï¼Œå¯æ·»åŠ è£…é¥°ç‰©å’ŒåŠ¨ç”»
   HangingObjects/ [z_index = 110]
   â”œâ”€â”€ Lanterns (Node2D) - å¯æ·»åŠ ç¯ç¬¼å¹¶é…ç½®æ‘†åŠ¨åŠ¨ç”»
   â”œâ”€â”€ Banners (Node2D) - å¯æ·»åŠ æ——å¸œå¹¶é…ç½®é£˜åŠ¨åŠ¨ç”»
   â””â”€â”€ Chains (Node2D) - å¯æ·»åŠ é“¾æ¡å¹¶é…ç½®æ™ƒåŠ¨åŠ¨ç”»
   ```

2. **è¿‘å‰æ™¯å±‚** - âœ… ç»“æ„å®Œæˆ
   ```gdscript
   # èŠ‚ç‚¹ç»“æ„å·²åˆ›å»ºï¼Œå¯æ·»åŠ å‰æ™¯è£…é¥°
   NearForeground/ [z_index = 100]
   â”œâ”€â”€ ForegroundPillars (Node2D) - å¯æ·»åŠ å‰æ™¯æŸ±å­
   â””â”€â”€ ForegroundRocks (Node2D) - å¯æ·»åŠ å‰æ™¯å²©çŸ³
   ```

3. **è¦†ç›–å±‚** - âœ… ç»“æ„å®Œæˆ
   ```gdscript
   # èŠ‚ç‚¹ç»“æ„å·²åˆ›å»ºï¼Œå¯æ·»åŠ ç¯å¢ƒæ•ˆæœ
   CoverLayer/ [z_index = 120]
   â”œâ”€â”€ Fog (Node2D) - å¯æ·»åŠ é›¾æ•ˆ
   â”œâ”€â”€ RainDrops (Node2D) - å¯æ·»åŠ é›¨æ»´æ•ˆæœ
   â””â”€â”€ LightEffects (Node2D) - å¯æ·»åŠ å…‰ç…§æ•ˆæœ
   ```

## 5. ç¾æœ¯èµ„æºè§„èŒƒ

### 5.1 è´´å›¾å°ºå¯¸å»ºè®®

```
å¤©ç©ºå±‚è´´å›¾:    2048x1024 (å¯é‡å¤å¹³é“º)
è¿œæ™¯å±‚è´´å›¾:    1024x512  (è¿œå±±ã€è¿œå»ºç­‘)
ä¸­æ™¯å±‚è´´å›¾:    1024x512  (è¿‘å»ºç­‘ã€å¤§æ ‘)
å‰æ™¯è£…é¥°:      512x512   (å•ä¸ªè£…é¥°ç‰©)
æ‚¬æŒ‚ç‰©:        256x256   (ç¯ç¬¼ã€æ——å¸œç­‰)
```

### 5.2 é€æ˜åº¦å¤„ç†

```gdscript
# å‰æ™¯é®æŒ¡ç‰©çš„é€æ˜åº¦è®¾ç½®
var foreground_sprite = Sprite2D.new()
foreground_sprite.modulate.a = 0.7  # 70%é€æ˜åº¦ï¼Œæ—¢é®æŒ¡åˆä¸å®Œå…¨æŒ¡ä½è§’è‰²
```

## 6. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 6.1 çº¹ç†ä¼˜åŒ–
- ä½¿ç”¨çº¹ç†å‹ç¼©æ ¼å¼ï¼ˆVRAM Compressedï¼‰
- è¿œæ™¯ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡è´´å›¾
- åˆ©ç”¨çº¹ç†é‡å¤è€Œéå¤§å›¾

### 6.2 èŠ‚ç‚¹ç®¡ç†
```gdscript
# æ ¹æ®ç›¸æœºä½ç½®åŠ¨æ€åŠ è½½/å¸è½½èƒŒæ™¯å…ƒç´ 
func _process(delta):
    var camera_pos = get_viewport().get_camera_2d().global_position
    
    # åªæ¸²æŸ“ç›¸æœºå¯è§èŒƒå›´å†…çš„èƒŒæ™¯å…ƒç´ 
    for layer in background_layers:
        var distance = layer.global_position.distance_to(camera_pos)
        layer.visible = distance < MAX_VISIBLE_DISTANCE
```

### 6.3 åŠ¨ç”»ä¼˜åŒ–
```gdscript
# ä½¿ç”¨ç»„åŠ¨ç”»è€Œéå•ä¸ªåŠ¨ç”»
var animation_player = AnimationPlayer.new()
# ä¸ºæ‚¬æŒ‚ç‰©åˆ›å»ºç»Ÿä¸€çš„æ‘†åŠ¨åŠ¨ç”»
# ä½¿ç”¨è¾ƒä½çš„å¸§ç‡è¿›è¡ŒèƒŒæ™¯åŠ¨ç”»
```

## 7. å…³å¡è®¾è®¡å·¥ä½œæµ

### 7.1 åˆ›å»ºæ–°å…³å¡èƒŒæ™¯
1. **å¤åˆ¶LEVEL_1_åºå¹•.tscnä½œä¸ºæ¨¡æ¿** âœ… å¯ç”¨ä½œæ¨¡æ¿
2. æ›¿æ¢å„å±‚çš„è´´å›¾èµ„æº
3. è°ƒæ•´è§†å·®æ»šåŠ¨å‚æ•°ï¼ˆå¦‚éœ€è¦ï¼‰
4. è®¾ç½®ç‰¹æœ‰çš„å‰æ™¯è£…é¥°
5. æµ‹è¯•è§†è§‰æ•ˆæœå’Œæ€§èƒ½

### 7.2 å…³å¡é…ç½®æ–‡ä»¶ - âœ… **å·²å®ç°é…ç½®ç³»ç»Ÿ**
```json
{
  "level_name": "forest_temple",
  "background_config": {
    "sky": "res://Graphics/Backgrounds/forest_sky.png",
    "distant": "res://Graphics/Backgrounds/forest_mountains.png",
    "midground": "res://Graphics/Backgrounds/forest_trees.png"
  },
  "foreground_config": {
    "hanging_objects": [
      {
        "type": "lantern",
        "position": [500, 800],
        "texture": "res://Graphics/Foreground/temple_lantern.png"
      }
    ]
  },
  "parallax_settings": {
    "sky_motion": [0.1, 0.1],
    "distant_motion": [0.3, 0.3],
    "mid_motion": [0.6, 0.6]
  }
}
```

**ğŸ“ æ³¨æ„**ï¼šå½“å‰å·²æœ‰å®Œæ•´çš„é…ç½®ç³»ç»Ÿåœ¨ConfigèŠ‚ç‚¹ä¸‹ï¼ŒåŒ…æ‹¬LevelConfigurationã€SpawnSettingsã€EnvironmentSettingsç­‰ã€‚

## 8. ğŸ’¡ **ç®€å•çš„è´´å›¾é…ç½®æ–¹æ³•**

### 8.1 ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®è´´å›¾

**âœ… æœ€ç®€å•çš„æ–¹æ³•** - æ— éœ€ä»»ä½•ä»£ç ï¼

1. **æ‰“å¼€å…³å¡åœºæ™¯**ï¼š
   - ä¾‹å¦‚ï¼š`LEVEL_1_åºå¹•.tscn`

2. **æ‰¾åˆ°èƒŒæ™¯å±‚èŠ‚ç‚¹**ï¼š
   ```
   BackgroundLayers/ParallaxBackground/
   â”œâ”€â”€ SkyLayer/SkySprites/Sky (Sprite2D)
   â”œâ”€â”€ DistantLayer/DistantSprites/Mountains (Sprite2D)  
   â””â”€â”€ MidgroundLayer/MidgroundSprites/Buildings (Sprite2D)
   ```

3. **è®¾ç½®è´´å›¾**ï¼š
   - é€‰æ‹©èŠ‚ç‚¹ï¼ˆå¦‚Skyï¼‰
   - åœ¨æ£€æŸ¥å™¨ä¸­æ‰¾åˆ°`Texture`å±æ€§
   - ç‚¹å‡»ä¸‹æ‹‰ç®­å¤´ â†’ `Load` â†’ é€‰æ‹©ä½ çš„å›¾ç‰‡æ–‡ä»¶
   - ä¿å­˜åœºæ™¯

### 8.2 ä¸åŒå…³å¡ä½¿ç”¨ä¸åŒè´´å›¾

**ä¸ºä¸åŒå…³å¡åˆ›å»ºä¸åŒçš„åœºæ™¯æ–‡ä»¶**ï¼š

```
Scenes/Levels/
â”œâ”€â”€ LEVEL_1_åºå¹•.tscn       # æ£®æ—èƒŒæ™¯
â”œâ”€â”€ LEVEL_2_æ²™æ¼ .tscn       # æ²™æ¼ èƒŒæ™¯
â”œâ”€â”€ LEVEL_3_æ´ç©´.tscn       # æ´ç©´èƒŒæ™¯
â””â”€â”€ LEVEL_4_åŸå¸‚.tscn       # åŸå¸‚èƒŒæ™¯
```

æ¯ä¸ªåœºæ™¯çš„èƒŒæ™¯å±‚å¯ä»¥è®¾ç½®å®Œå…¨ä¸åŒçš„è´´å›¾ï¼Œæ–‡ä»¶åéšæ„ã€‚

### 8.3 æ¨èçš„è´´å›¾æ–‡ä»¶ç»„ç»‡

```
Graphics/Backgrounds/
â”œâ”€â”€ forest_sky.png           # éšæ„å‘½å
â”œâ”€â”€ desert_sunset.png        # éšæ„å‘½å
â”œâ”€â”€ cave_darkness.png        # éšæ„å‘½å
â”œâ”€â”€ city_skyline.png         # éšæ„å‘½å
â”œâ”€â”€ mountain_range.png       # éšæ„å‘½å
â””â”€â”€ ...æ›´å¤šèƒŒæ™¯å›¾ç‰‡
```

### 8.4 âœ¨ **ç³»ç»Ÿä¼˜åŠ¿**

1. **æå…¶ç®€å•**ï¼šæ— éœ€ç¼–å†™ä»»ä½•ä»£ç 
2. **å®Œå…¨è‡ªç”±**ï¼šæ–‡ä»¶åã€è·¯å¾„éšæ„è®¾ç½®
3. **æ‰€è§å³æ‰€å¾—**ï¼šåœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥é¢„è§ˆæ•ˆæœ
4. **æ˜“äºç®¡ç†**ï¼šæ¯ä¸ªå…³å¡åœºæ™¯ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„èƒŒæ™¯
5. **æ— bugé£é™©**ï¼šé¿å…äº†åŠ¨æ€åŠ è½½å¯èƒ½çš„é”™è¯¯

## 9. ä»£ç ç¤ºä¾‹ï¼šå®Œæ•´å®ç°

### 8.1 BackgroundManagerè„šæœ¬
```gdscript
extends Node2D
class_name BackgroundManager

@export var level_config: Resource
var parallax_background: ParallaxBackground
var foreground_layers: CanvasLayer

func _ready():
    setup_background_structure()
    load_level_background()

func setup_background_structure():
    # åˆ›å»ºèƒŒæ™¯å±‚
    var bg_canvas = CanvasLayer.new()
    bg_canvas.name = "BackgroundLayers"
    bg_canvas.layer = -1  # æ³¨æ„ï¼šä½¿ç”¨layerè€Œä¸æ˜¯z_index
    get_parent().add_child(bg_canvas)
    
    # åˆ›å»ºè§†å·®èƒŒæ™¯
    parallax_background = ParallaxBackground.new()
    bg_canvas.add_child(parallax_background)
    
    # åˆ›å»ºå‰æ™¯å±‚
    foreground_layers = CanvasLayer.new()
    foreground_layers.name = "ForegroundLayers"
    foreground_layers.layer = 1  # æ³¨æ„ï¼šä½¿ç”¨layerè€Œä¸æ˜¯z_index
    get_parent().add_child(foreground_layers)

func load_level_background():
    if level_config:
        create_sky_layer()
        create_distant_layer()
        create_midground_layer()
        create_foreground_elements()

func create_sky_layer():
    var sky_layer = ParallaxLayer.new()
    sky_layer.name = "SkyLayer"
    sky_layer.motion_scale = Vector2(0.1, 0.1)  # å½“å‰é…ç½®
    parallax_background.add_child(sky_layer)
    
    # æ·»åŠ å¤©ç©ºç²¾çµ...

# å…¶ä»–å±‚çš„åˆ›å»ºæ–¹æ³•...
```

### 8.2 åœ¨BattleSceneä¸­çš„é›†æˆ
```gdscript
# åœ¨BattleSceneçš„_ready()ä¸­æ·»åŠ 
func setup_background_system():
    var bg_manager = preload("res://Scripts/BackgroundManager.gd").new()
    bg_manager.level_config = current_level_config
    add_child(bg_manager)
```

## 9. å®ç°çŠ¶æ€æ€»ç»“

### âœ… **å·²å®Œæˆçš„é‡Œç¨‹ç¢‘**
1. **æ¶æ„è®¾è®¡** - 100%å®Œæˆ
2. **èŠ‚ç‚¹ç»“æ„** - 100%å®Œæˆï¼Œå®Œå…¨æŒ‰ç…§è®¾è®¡æ–‡æ¡£å®ç°
3. **è§†å·®é…ç½®** - 100%å®Œæˆï¼Œmotion_scaleè®¾ç½®æ­£ç¡®
4. **å±‚æ¬¡ç®¡ç†** - 100%å®Œæˆï¼Œæ‰€æœ‰Z-indexå’ŒCanvasLayeré…ç½®æ­£ç¡®
5. **éšœç¢ç‰©ç³»ç»Ÿ** - 100%å®Œæˆï¼Œå¤šç§éšœç¢ç‰©å·²é…ç½®
6. **ç”Ÿæˆç‚¹ç³»ç»Ÿ** - 100%å®Œæˆï¼Œè§’è‰²ç”Ÿæˆç‚¹å®Œæ•´é…ç½®
7. **é…ç½®ç³»ç»Ÿ** - 100%å®Œæˆï¼Œå®Œæ•´çš„å…³å¡é…ç½®ç»“æ„

### ğŸ”„ **ä¸‹ä¸€æ­¥ä»»åŠ¡**
1. **ç¾æœ¯èµ„æºæ·»åŠ **ï¼š
   - æ·»åŠ èƒŒæ™¯è´´å›¾ï¼ˆæ–‡ä»¶åéšæ„ï¼‰
   - ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®åˆ°å¯¹åº”çš„Sprite2DèŠ‚ç‚¹
   - æ·»åŠ å‰æ™¯è£…é¥°ç‰©å’Œç‰¹æ•ˆèµ„æº

2. **è§†è§‰å¢å¼º**ï¼š
   - ä¸ºå‰æ™¯å±‚æ·»åŠ è£…é¥°ç‰©ï¼ˆç¯ç¬¼ã€æ——å¸œç­‰ï¼‰
   - æ·»åŠ å¤©æ°”æ•ˆæœï¼ˆé›¨æ»´ã€é›¾æ°”ç­‰ï¼‰
   - å®ç°æ‚¬æŒ‚ç‰©æ‘†åŠ¨åŠ¨ç”»

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - è´´å›¾å‹ç¼©ä¼˜åŒ–
   - è§†è·è£å‰ªå®ç°
   - åŠ¨æ€LODç³»ç»Ÿ

## 10. æ€»ç»“

### ğŸ‰ **é‡å¤§æˆå°±**
**LEVEL_1_åºå¹•.tscnå®Œå…¨ç¬¦åˆå¤šå±‚èƒŒæ™¯ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼** è¿™æ˜¯ä¸€ä¸ªå®Œç¾çš„å®ç°æ¡ˆä¾‹ï¼š

- âœ… **æ¶æ„ä¸€è‡´æ€§**ï¼š100%æŒ‰ç…§è®¾è®¡æ–‡æ¡£å®ç°
- âœ… **èŠ‚ç‚¹ç»“æ„**ï¼šæ‰€æœ‰å±‚æ¬¡å’Œå‘½åå®Œå…¨åŒ¹é…
- âœ… **æŠ€æœ¯è§„èŒƒ**ï¼šè§†å·®é…ç½®ã€Z-indexè®¾ç½®å®Œå…¨æ­£ç¡®
- âœ… **æ‰©å±•æ€§**ï¼šä¸ºåç»­ç¾æœ¯èµ„æºæ·»åŠ æä¾›äº†å®Œç¾çš„æ¡†æ¶

### ğŸ“‹ **ç³»ç»Ÿç‰¹è‰²**
- **æ¸…æ™°çš„å±‚æ¬¡ç»“æ„**: é€šè¿‡Z-indexå’ŒCanvasLayerå®ç°ç²¾ç¡®çš„æ¸²æŸ“é¡ºåº
- **è§†å·®æ»šåŠ¨æ•ˆæœ**: å¢å¼ºæ¸¸æˆçš„æ·±åº¦æ„Ÿå’Œæ²‰æµ¸æ„Ÿ  
- **çµæ´»çš„æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„èƒŒæ™¯å±‚å’Œè£…é¥°å…ƒç´ 
- **è‰¯å¥½çš„æ€§èƒ½**: é€šè¿‡ä¼˜åŒ–ç­–ç•¥ä¿æŒæµç•…è¿è¡Œ
- **æ˜“äºç»´æŠ¤**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºå…³å¡åˆ¶ä½œå’Œä¿®æ”¹

### ğŸš€ **å¯ä½œä¸ºæ¨¡æ¿**
å½“å‰çš„LEVEL_1_åºå¹•.tscnå¯ä»¥ä½œä¸ºï¼š
- **æ–°å…³å¡çš„æ¨¡æ¿**ï¼šå¤åˆ¶å¹¶æ›¿æ¢è´´å›¾å³å¯
- **æ ‡å‡†å‚è€ƒ**ï¼šå…¶ä»–å…³å¡çš„å®ç°æ ‡å‡†
- **æµ‹è¯•åŸºå‡†**ï¼šæ–°åŠŸèƒ½å’Œä¼˜åŒ–çš„æµ‹è¯•åŸºç¡€

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œæ‚¨å¯ä»¥åˆ›å»ºç±»ä¼¼ã€Šæ‹³çš‡97ã€‹ç­‰ç»å…¸æ ¼æ–—æ¸¸æˆçš„ä¸°å¯Œè§†è§‰å±‚æ¬¡æ•ˆæœï¼Œä¸ºæ‚¨çš„2Dä¾§è§†è§’æˆ˜æ–—æ¸¸æˆå¢æ·»æ›´å¤šçš„è§†è§‰é­…åŠ›ã€‚å½“å‰çš„å®ç°å·²ç»ä¸ºåç»­çš„ç¾æœ¯èµ„æºæ·»åŠ å’Œè§†è§‰æ•ˆæœå¢å¼ºæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚ 